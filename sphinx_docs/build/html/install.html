<!DOCTYPE html>
<html class="writer-html5" lang="fr" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Installation &mdash; Documentation SoVisu 1.0.1</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/translations.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" />
    <link rel="next" title="Guide de l’utilisateur" href="user_guide.html" />
    <link rel="prev" title="Fonctionnement" href="fonctionnement.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> SoVisu
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contenu:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="fonctionnement.html">Fonctionnement</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prerequis">Prérequis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-de-l-environnement">Configuration de l’environnement</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mise-en-route">Mise en route</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#initialisation-des-processus-dans-la-partie-admin">Initialisation des processus dans la partie Admin</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#specificites-de-la-mise-en-route-de-sovisu-pour-le-developpement">Spécificités de la mise en route de SoVisu pour le développement</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#initialisation-des-visualisations-dans-kibana">Initialisation des visualisations dans Kibana</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mise-en-production">Mise en production</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="user_guide.html">Guide de l’utilisateur</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Développement</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SoVisu</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Installation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/install.rst.txt" rel="nofollow"> Afficher la source de la page</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Lien permanent vers ce titre"></a></h1>
<p>SoVisu est un projet s’appuyant sur le <a class="reference external" href="https://www.djangoproject.com">framework Django</a> et qui est constitué de 2 applications:</p>
<ul class="simple">
<li><p>elasticHal, qui est chargée de récupérer les informations les structures et les laboratoires.</p></li>
<li><p>sovisuhal qui collecte les identifiants chercheurs, les métadonnées de leurs publications sur Hal pour présenter l</p></li>
</ul>
<p>Les données récupérées sont stockées sur un moteur de recherche <a class="reference external" href="https://www.elastic.co/fr/elasticsearch/">Elasticsearch</a>, couplé à l’interface utilisateur <a class="reference external" href="https://www.elastic.co/fr/kibana/">Kibana</a> qui est utilisée pour créer les tableaux de bord proposés aux utilisateurs.</p>
<section id="prerequis">
<h2>Prérequis<a class="headerlink" href="#prerequis" title="Lien permanent vers ce titre"></a></h2>
<p>Afin d’initialiser le projet, il est nécessaire de disposer d’une machine équipée de Python (version 3.9=~), de Docker, ainsi que de Git.</p>
<p>Il n’est pas nécessaire de créer des index pour Elasticsearch, ces derniers sont créés par elasticHal lors de la collecte.</p>
<p>Le code de SoVisu est accessible sur <a class="reference external" href="https://github.com/Patent2net/SoVisu">https://github.com/Patent2net/SoVisu</a> .</p>
</section>
<section id="configuration-de-l-environnement">
<h2>Configuration de l’environnement<a class="headerlink" href="#configuration-de-l-environnement" title="Lien permanent vers ce titre"></a></h2>
<ol class="arabic simple">
<li><p>Clonez le répertoire</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(.venv)</span> <span class="gp">$ </span>git clone https://github.com/Patent2net/SoVisu/
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>installez les requirements dans le projet SoVisu</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(.venv)</span> <span class="gp">$ </span>pip install -r requirements.txt
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Dans doc/VisuStack, créer le dossier <code class="docutils literal notranslate"><span class="pre">volume</span></code> ainsi que les sous-dossiers <code class="docutils literal notranslate"><span class="pre">backup1</span></code>, <code class="docutils literal notranslate"><span class="pre">data1</span></code>, <code class="docutils literal notranslate"><span class="pre">data2</span></code>, <code class="docutils literal notranslate"><span class="pre">data3</span></code> et <code class="docutils literal notranslate"><span class="pre">MB-data</span></code>.</p></li>
<li><p>Exécutez la commande suivante pour installer l’environnement serveur utilisé par le projet:</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(.venv)</span> <span class="gp">$ </span>docker-compose doc/VisuStack/docker-compose.yml
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Avertissement</p>
<p>Cette commande peut prendre du temps à s’exécuter, car elle télécharge les images Docker de Kibana, ElasticSearch et Redis qui sont nécessaires au fonctionnement du projet.</p>
</div>
<p>SoVisu s’appuie sur une architecture telle la figure ci-dessous: Docker héberge tous les services supports excepté le serveur Django. Nginx sert de frontal de sécurité à tous les services y compris SoVisu.</p>
<a class="reference internal image-reference" href="_images/SoVisu-Architecture.drawio.png"><img alt="_images/SoVisu-Architecture.drawio.png" class="align-center" src="_images/SoVisu-Architecture.drawio.png" style="width: 600px;" /></a>
<ol class="arabic simple" start="5">
<li><p>Initialisez les migrations de SoVisu:</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(.venv)</span> <span class="gp">$ </span>python manage.py migrate
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>Désignez le serveur CAS de l’institution:</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(.venv)</span> <span class="gp">$ </span>python manage.py add_institution <span class="s2">&quot;nom de l&#39;institution&quot;</span> https://cas.exemple.fr
</pre></div>
</div>
<ol class="arabic simple" start="7">
<li><p>Créez un profil administrateur:</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(.venv)</span> <span class="gp">$ </span>python manage.py createsuperuser
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Astuce</p>
<p>il vous sera demandé de rentrer un identifiant, une adresse mail et un mot de passe.
Bien que l’identifiant et le mot de passe soient obligatoires, le champ adresse mail est optionnel.</p>
</div>
</section>
<section id="mise-en-route">
<h2>Mise en route<a class="headerlink" href="#mise-en-route" title="Lien permanent vers ce titre"></a></h2>
<div class="admonition warning">
<p class="admonition-title">Avertissement</p>
<p>Avant toute mise en route de SoVisu, vérifiez que l’instance elastic avec lequel le projet interagit est active.
Si ce n’est pas le cas, SoVisu renverra un message d’erreur au lieu de s’initialiser normalement.</p>
</div>
<section id="initialisation-des-processus-dans-la-partie-admin">
<h3>Initialisation des processus dans la partie Admin<a class="headerlink" href="#initialisation-des-processus-dans-la-partie-admin" title="Lien permanent vers ce titre"></a></h3>
<ol class="arabic simple">
<li><p>Lancez SoVisu:</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp gp-VirtualEnv">(.venv)</span> <span class="gp">$ </span>python manage.py runserver
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Visitez l’adresse suivante: <a class="reference external" href="http://127.0.0.1:8000/admin/">http://127.0.0.1:8000/admin/</a></p></li>
<li><p>Renseignez les identifiants administrateur créés précédemment.</p></li>
</ol>
<dl class="simple">
<dt>En arrivant dans l’interface d’administration, vous pouvez voir les différentes Applications de SoVisu:</dt><dd><ul class="simple">
<li><p>« Authentification et autorisation », qui est présente par défaut dans Django. Elle permet de gérer les utilisateurs se connectant avec des identifiants créés depuis l’interface administrateur ou avec des commandes depuis manage.py.</p></li>
<li><p>« Elastichal », qui permet d’initialiser la base de données Elasticsearch.</p></li>
<li><p>« Uniauth », qui permet dans le cas d’une installation dans une institution de gérer la connection à partir des identifiants CAS.</p></li>
</ul>
</dd>
</dl>
<a class="reference internal image-reference" href="_images/affichage_admin.png"><img alt="_images/affichage_admin.png" class="align-center" src="_images/affichage_admin.png" style="width: 600px;" /></a>
<dl class="simple">
<dt>Dans la partie « Elastichal », trois modèles sont disponibles:</dt><dd><ul class="simple">
<li><p>« Chercheurs », qui permet de stocker les informations de base concernant les objets chercheurs.</p></li>
<li><p>« Laboratoires », qui permet de stocker les informations de base concernant les objets laboratoires.</p></li>
<li><p>« Structures », qui permet de stocker les informations de base concernant les objets structures institutionnelles dont dépendent les laboratoires.</p></li>
</ul>
</dd>
</dl>
<ol class="arabic simple" start="4">
<li><p>Cliquez sur « Chercheurs » dans l’onglet « Elastichal ».</p></li>
</ol>
<a class="reference internal image-reference" href="_images/visualisation_menu_elastichal.png"><img alt="_images/visualisation_menu_elastichal.png" class="align-center" src="_images/visualisation_menu_elastichal.png" style="width: 800px;" /></a>
<dl class="simple">
<dt>Le menu des modèles présent dans l’application Elastichal vous propose plusieurs options disponibles en cliquant sur les boutons situés en haut à droite de l’écran:</dt><dd><ul class="simple">
<li><p>« Peupler Elastic », permet d’initialiser la base de données Elasticsearch à partir des données présentes dans les modèles Elastichal.</p></li>
<li><p>« Mettre à jour Elastic », permet de mettre à jour les données présentes dans Elasticsearch à partir des données présentes dans les modèles Elastichal.</p></li>
<li><p>« Importer des données », permet d’importer des données dans le modèle à partir d’un fichier CSV.</p></li>
<li><p>« Ajouter chercheur », permet d’ajouter un chercheur manuellement dans le modèle.</p></li>
</ul>
</dd>
</dl>
<p>Dans le cas de la mise en route de SoVisu, nous allons importer des données à partir d’un fichier CSV.</p>
<ol class="arabic simple" start="5">
<li><p>Cliquez sur « Importer des données ». Sur la page suivante il vous sera demandé d’importer un fichier. Il est important que celui ci soit au format CSV, et qu’il contienne des champs précis en fonction du modèle à remplir (voir les astuces ci dessous pour plus de détails).</p></li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Astuce</p>
<p>Dans le cas du modèle « Chercheurs », le fichier csv devra contenir les colonnes suivante:
<em>structSirene, ldapId, name, type, function, mail, lab, supannAffectation,</em>
<em>supannEntiteAffectationPrincipale, halId_s, labHalId, idRef, structDomain, firstName, lastName, aurehalId</em></p>
<p>exemple de fichier CSV Chercheurs:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>structSirene</p></th>
<th class="head"><p>ldapId</p></th>
<th class="head"><p>name</p></th>
<th class="head"><p>type</p></th>
<th class="head"><p>function</p></th>
<th class="head"><p>mail</p></th>
<th class="head"><p>lab</p></th>
<th class="head"><p>supannAffectation</p></th>
<th class="head"><p>supannEntiteAffectationPrincipale</p></th>
<th class="head"><p>halId_s</p></th>
<th class="head"><p>labHalId</p></th>
<th class="head"><p>idRef</p></th>
<th class="head"><p>structDomain</p></th>
<th class="head"><p>firstName</p></th>
<th class="head"><p>lastName</p></th>
<th class="head"><p>aurehalId</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>198307662</p></td>
<td><p>dreymond</p></td>
<td><p>REYMOND David</p></td>
<td><p>Personnel</p></td>
<td><p>Enseignant Chercheur Titulaire</p></td>
<td><p><a class="reference external" href="mailto:david&#46;reymond&#37;&#52;&#48;univ-tln&#46;fr">david<span>&#46;</span>reymond<span>&#64;</span>univ-tln<span>&#46;</span>fr</a></p></td>
<td><p>IMSIC</p></td>
<td><p>IMSIC</p></td>
<td><p>IUT TC</p></td>
<td><p>david-reymond</p></td>
<td><p>527028</p></td>
<td><p>122796527</p></td>
<td><p>univ-tln.fr</p></td>
<td><p>David</p></td>
<td><p>REYMOND</p></td>
<td><p>599503</p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonition tip">
<p class="admonition-title">Astuce</p>
<p>Dans le cas du modèle « Laboratoires », le fichier csv devra contenir les colonnes suivante:
<em>structSirene; acronym; label; halStructId; rsnr; idRef</em></p>
<p>exemple de fichier CSV Laboratoires:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 17%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>structSirene</p></th>
<th class="head"><p>acronym</p></th>
<th class="head"><p>label</p></th>
<th class="head"><p>halStructId</p></th>
<th class="head"><p>rsnr</p></th>
<th class="head"><p>idRef</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>198307662</p></td>
<td><p>IMSIC</p></td>
<td><p>Institut mediterranéen des sciences de l’information et de la communication</p></td>
<td><p>527028</p></td>
<td><p>527028</p></td>
<td><p>233736085</p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonition tip">
<p class="admonition-title">Astuce</p>
<p>Dans le cas du modèle « Structures », le fichier csv devra contenir les colonnes suivante:
<em>structSirene, label, acronym, domain</em></p>
<p>exemple de fichier CSV structures:</p>
<table class="docutils align-center">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>structSirene</p></th>
<th class="head"><p>label</p></th>
<th class="head"><p>acronym</p></th>
<th class="head"><p>domain</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>198307662</p></td>
<td><p>Université de Toulon</p></td>
<td><p>UTLN</p></td>
<td><p>univ-tln.fr</p></td>
</tr>
</tbody>
</table>
</div>
<ol class="arabic simple" start="6">
<li><p>Répétez l’opération pour les autres modèles dans Elastichal.</p></li>
<li><p>Une fois les trois modèles complétés, retournez sur le menu d’un des modèles Elastichal et cliquez sur « Peupler Elastic ».</p></li>
</ol>
<a class="reference internal image-reference" href="_images/peupler_elastic.png"><img alt="_images/peupler_elastic.png" class="align-center" src="_images/peupler_elastic.png" style="width: 800px;" /></a>
<ol class="arabic simple" start="8">
<li><dl class="simple">
<dt>Par défaut, « Peupler elastic » propose de remplir la base de données Elasticsearch avec les données présentes dans les modèles Structures, Laboratoires et Chercheurs.</dt><dd><p>Cliquez sur « soumettre » afin de lancer le processus de collecte, Il est possible de voir l’état de la collecte dans la partie « Progression » de la page.</p>
</dd>
</dl>
</li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Avertissement</p>
<p>Lors d’une première mise en route, il est impératif de lancer « peupler elastic » avec l’ensemble des modèles remplis.
Le modèle structure permet de délimiter la récupération dans le cas ou les laboratoires et/ou chercheurs seraient recensés dans plusieurs structures.
La récupération des données dans Elasticsearch est longue, et peut prendre du temps.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Astuce</p>
<p>La fonction « peupler elastic » peut également être utilisée par la suite pour mettre à jour en masse l’ensemble des données d’un ou de l’ensemble des modèles proposés par SoVisu:
celle ci se base sur les données des modèles présent dans Django mais également les éléments déjà importés dans Elasticsearch.
Pour cela, il suffit de sélectionner la partie qui doit être mise à jour pour lancer un processus allégé.</p>
</div>
<section id="specificites-de-la-mise-en-route-de-sovisu-pour-le-developpement">
<h4>Spécificités de la mise en route de SoVisu pour le développement<a class="headerlink" href="#specificites-de-la-mise-en-route-de-sovisu-pour-le-developpement" title="Lien permanent vers ce titre"></a></h4>
<p>Dans le cas d’une installation de SoVisu sur une machine de développement n’ayant pas accès à l’authentification par CAS, il est nécessaire de définir un profil utilisateur afin d’accéder à l’application.
Dans le cas d’un profil chercheur, celui ci est identifié par SoVisu grâce à son identifiant ldapId. Le nom d’utilisateur est le même que l’identifiant ldapId.</p>
<p>Il est cependant possible de définir un profil utilisateur nommé « adminlab », reconnu par SoVisu comme un administrateur du laboratoire et ayant donc accès complet à l’application.</p>
<ol class="arabic simple">
<li><p>Dans l’interface d’administration de SoVisu, cliquez sur « Utilisateurs » dans « Authentification et autorisations ».</p></li>
<li><p>Cliquez sur « Ajouter utilisateur ».</p></li>
<li><p>Créez un utilisateur ayant pour nom d’utilisateur « adminlab », le mot de passe est libre de choix.</p></li>
<li><p>Cliquez sur « Enregistrer ».</p></li>
</ol>
</section>
</section>
<section id="initialisation-des-visualisations-dans-kibana">
<h3>Initialisation des visualisations dans Kibana<a class="headerlink" href="#initialisation-des-visualisations-dans-kibana" title="Lien permanent vers ce titre"></a></h3>
<p>Dans Kibana, il est possible de créer des visualisations à partir des données présentes dans Elasticsearch.
Par défaut SoVisu propose des visualisations qui sont disponibles dans les dossiers du projet:
SoVisu/doc/Dashboards/</p>
<p>Afin de les rendre disponible il est nécessaire de les importer dans l’instance Kibana dont dépend votre installation.</p>
<ol class="arabic simple">
<li><p>Dans Kibana, ouvrez le menu.</p></li>
<li><p>Dans la section Management, cliquez sur « Stack Management »</p></li>
<li><p>Sur la nouvelle page affichée, allez dans « Saved Objects »(dans la section Kibana).</p></li>
<li><p>Cliquez sur « Import » et importez les fichiers disponibles dans le dossier SoVisu/doc/Dashboards/, en sélectionnant  les options « check for existing objects » et « automatically overwrite conflicts ».</p></li>
<li><p>Cliquez sur « import ».</p></li>
<li><p>Kibana vous signale l’ensemble des objets modifiés; Cliquez sur « Done »</p></li>
<li><p>répétez les points 4 à 6 pour l’ensemble des fichiers dans le dossier.</p></li>
</ol>
</section>
</section>
<section id="mise-en-production">
<h2>Mise en production<a class="headerlink" href="#mise-en-production" title="Lien permanent vers ce titre"></a></h2>
<div class="admonition warning">
<p class="admonition-title">Avertissement</p>
<p>à compléter</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pied de page">
        <a href="fonctionnement.html" class="btn btn-neutral float-left" title="Fonctionnement" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Précédent</a>
        <a href="user_guide.html" class="btn btn-neutral float-right" title="Guide de l’utilisateur" accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, David Reymond, Alaric Tabariès, Esteban Bara.</p>
  </div>

  Compilé avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>